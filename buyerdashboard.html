<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buyer Dashboard - Climate-Aware Land Buying</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --text-dark: #1f2937;
            --bg-light: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--primary-color) !important;
        }

        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 4rem 0;
        }

        .overview-card {
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-5px);
        }

        .land-card {
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .land-card:hover {
            transform: translateY(-3px);
        }

        .sustainability-badge {
            background: var(--secondary-color);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            font-size: 0.75rem;
        }

        #map {
            height: 500px;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .map-sidebar {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            height: 500px;
            overflow-y: auto;
        }

        .data-card {
            border-left: 4px solid var(--primary-color);
            margin-bottom: 1rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 2rem;
        }

        .section-title {
            color: var(--text-dark);
            font-weight: 600;
            margin-bottom: 2rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-success {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .fade-in {
            opacity: 0;
            transform: translateY(20px);
        }

        .fade-in.active {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <!-- Sticky Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="#"><i class="fas fa-globe-americas me-2"></i>LandBuyer Pro</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#overview">Overview</a></li>
                    <li class="nav-item"><a class="nav-link" href="#lands">Available Lands</a></li>
                    <li class="nav-item"><a class="nav-link" href="#analytics">Analytics</a></li>
                    <li class="nav-item"><a class="nav-link" href="#planner">Planner Tools</a></li>
                    <li class="nav-item"><a class="nav-link" href="#nasa-data">NASA Data</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#supportModal">Support</a></li>
                    <li class="nav-item"><a class="nav-link text-danger" href="logout.do"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold mb-4">Buyer Dashboard</h1>
            <p class="lead mb-4">Make informed land purchasing decisions with NASA climate insights and environmental data</p>
            <a href="#planner" class="btn btn-light btn-lg">Explore Interactive Map</a>
        </div>
    </section>

    <!-- Overview Section -->
    <section id="overview" class="py-5">
        <div class="container">
            <h2 class="section-title text-center">Quick Overview</h2>
            <div class="row g-4">
                <div class="col-md-4">
                    <div class="card overview-card h-100 text-center">
                        <div class="card-body">
                            <i class="fas fa-map-marked-alt fa-3x text-primary mb-3"></i>
                            <h3 class="card-title">Available Lands</h3>
                            <h2 class="text-primary">10</h2>
                            <p class="card-text">Properties ready for analysis</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card overview-card h-100 text-center">
                        <div class="card-body">
                            <i class="fas  fa-3x text-success mb-3"></i>
                            <h3 class="card-title">Average Green Score</h3>
                            <h2 class="text-success">75</h2>
                            <p class="card-text">Environmental sustainability rating</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card overview-card h-100 text-center">
                        <div class="card-body">
                            <i class="fas fa-chart-line fa-3x text-warning mb-3"></i>
                            <h3 class="card-title">Insights Viewed</h3>
                            <h2 class="text-warning">15</h2>
                            <p class="card-text">NASA data reports analyzed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Available Lands Section -->
    <section id="lands" class="py-5 bg-white">
        <div class="container">
            <h2 class="section-title text-center">Available Lands</h2>
            <div class="row g-4">
                <div class="col-md-6 col-lg-4">
                    <div class="card land-card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h5 class="card-title">Urban Plot A</h5>
                                <span class="sustainability-badge">High Green Score</span>
                            </div>
                            <p class="card-text"><i class="fas fa-map-marker-alt text-primary"></i> Delhi (NCR) </p>
                            <p class="card-text">2.5 acres Mixed-use potential</p>
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary btn-sm" onclick="viewLandDetails('Urban Plot A')">View Details</button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="markOnMap(28.6139, 77.2090)">Mark on Map</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card land-card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h5 class="card-title">Rural Land B</h5>
                                <span class="sustainability-badge">Medium Green Score</span>
                            </div>
                            <p class="card-text"><i class="fas fa-map-marker-alt text-primary"></i> Chandigarh</p>
                            <p class="card-text">15 acres Agricultural potential</p>
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary btn-sm" onclick="viewLandDetails('Rural Land B')">View Details</button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="markOnMap(30.2672, -97.7431)">Mark on Map</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-lg-4">
                    <div class="card land-card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <h5 class="card-title">Coastal Property C</h5>
                                <span class="sustainability-badge">High Green Score</span>
                            </div>
                            <p class="card-text"><i class="fas fa-map-marker-alt text-primary"></i>  Mumbai Basti </p>
                            <p class="card-text">5 acres Waterfront access</p>
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary btn-sm" onclick="viewLandDetails('Coastal Property C')">View Details</button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="markOnMap(25.7617, -80.1918)">Mark on Map</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analytics Section -->
    <section id="analytics" class="py-5">
        <div class="container">
            <h2 class="section-title text-center">Environmental Analytics</h2>
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Environmental Trends</h5>
                            <!-- Added full view button for trends chart -->
                            <button class="btn btn-outline-primary btn-sm" onclick="showFullChart('trendsChart', 'Environmental Trends')">
                                <i class="fas fa-expand"></i> Full View
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="trendsChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Risk Assessment</h5>
                            <!-- Added full view button for risk chart -->
                            <button class="btn btn-outline-primary btn-sm" onclick="showFullChart('riskChart', 'Risk Assessment')">
                                <i class="fas fa-expand"></i> Full View
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="riskChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Planner Tools Section -->
    <section id="planner" class="py-5 bg-white">
        <div class="container-fluid">
            <h2 class="section-title text-center">Interactive Planner Tools</h2>
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="mb-3">
                        <label for="layerSelect" class="form-label">NASA Data Layer:</label>
                        <select id="layerSelect" class="form-select" onchange="changeMapLayer()">
                            <option value="satellite">Satellite Imagery</option>
                            <option value="ndvi">NDVI (Vegetation Health)</option>
                            <option value="lst">Land Surface Temperature</option>
                            <option value="precipitation">Precipitation</option>
                        </select>
                    </div>
                    <div id="map"></div>
                </div>
                <div class="col-lg-4">
                    <div class="map-sidebar" id="mapSidebar">
                        <div class="text-center text-muted">
                            <i class="fas fa-map-marker-alt fa-3x mb-3"></i>
                            <p>Click on the map to mark a location and view NASA data insights</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NASA Data Fetch Section -->
    <section id="nasa-data" class="py-5">
        <div class="container">
            <h2 class="section-title text-center">NASA Data Fetch</h2>
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <form id="nasaDataForm">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label for="latitude" class="form-label">Latitude</label>
                                        <input type="number" class="form-control" id="latitude" step="0.0001" min="-90" max="90" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="longitude" class="form-label">Longitude</label>
                                        <input type="number" class="form-control" id="longitude" step="0.0001" min="-180" max="180" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="startDate" class="form-label">Start Date</label>
                                        <input type="date" class="form-control" id="startDate" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="endDate" class="form-label">End Date</label>
                                        <input type="date" class="form-control" id="endDate" required>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Data Types</label>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="ndvi" value="ndvi" checked>
                                                    <label class="form-check-label" for="ndvi">NDVI</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="lst" value="lst" checked>
                                                    <label class="form-check-label" for="lst">Land Surface Temperature</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="precipitation" value="precipitation">
                                                    <label class="form-check-label" for="precipitation">Precipitation</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="airquality" value="airquality">
                                                    <label class="form-check-label" for="airquality">Air Quality</label>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="groundwater" value="groundwater">
                                                    <label class="form-check-label" for="groundwater">Groundwater</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <button type="submit" class="btn btn-primary">Fetch NASA Data</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <div id="dataResults" class="mt-4" style="display: none;">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">NASA Data Results</h5>
                                <button class="btn btn-success btn-sm" onclick="saveToDatabase()">Save to Database</button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-striped" id="resultsTable">
                                        <thead>
                                            <tr>
                                                <th>Data Type</th>
                                                <th>Value</th>
                                                <th>Unit</th>
                                                <th>Quality</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NASA Data Explanation Section -->
    <section class="py-5 bg-white">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <button class="btn btn-link text-decoration-none p-0" type="button" data-bs-toggle="collapse" data-bs-target="#nasaExplanation">
                                    How We Use NASA Data <i class="fas fa-chevron-down"></i>
                                </button>
                            </h5>
                        </div>
                        <div id="nasaExplanation" class="collapse">
                            <div class="card-body">
                                <p class="mb-4">Our platform integrates multiple NASA Earth observation datasets to provide comprehensive environmental insights for land evaluation:</p>
                                
                                <div class="row g-4">
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-leaf text-success me-2"></i>MODIS/Landsat NDVI</h6>
                                        <p class="small">Normalized Difference Vegetation Index measures vegetation health and density, crucial for agricultural potential assessment.</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-thermometer-half text-danger me-2"></i>MODIS LST</h6>
                                        <p class="small">Land Surface Temperature data helps evaluate climate conditions and seasonal variations affecting land use.</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-wind text-info me-2"></i>AIRS/OMI Air Quality</h6>
                                        <p class="small">Atmospheric data including NO2 levels and aerosol optical depth for environmental health assessment.</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-cloud-rain text-primary me-2"></i>GPM Precipitation</h6>
                                        <p class="small">Global Precipitation Measurement data for water availability and flood risk analysis.</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-tint text-secondary me-2"></i>GRACE Groundwater</h6>
                                        <p class="small">Gravity Recovery and Climate Experiment data for groundwater storage anomaly tracking.</p>
                                    </div>
                                    <div class="col-md-6">
                                        <h6><i class="fas fa-satellite text-warning me-2"></i>GIBS Imagery</h6>
                                        <p class="small">Global Imagery Browse Services provide real-time satellite imagery for visual land assessment.</p>
                                    </div>
                                </div>
                                
                               
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6>Data Sources</h6>
                    <ul class="list-unstyled small">
                        <li><a href="#" class="text-light">NASA Earth Observing System Data</a></li>
                        <li><a href="#" class="text-light">MODIS Terra/Aqua Satellites</a></li>
                        <li><a href="#" class="text-light">Landsat Program</a></li>
                        <li><a href="#" class="text-light">Global Precipitation Measurement</a></li>
                    </ul>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small mb-0">&copy; 2025 LandBuyer Pro. All rights reserved.</p>
                    <p class="small">Powered by NASA Earth Science Data</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Full View Chart Modal -->
    <div class="modal fade" id="chartModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="chartModalTitle">Chart Full View</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div style="height: 500px;">
                        <canvas id="fullViewChart"></canvas>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="downloadChart()">Download Chart</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Support Modal -->
    <div class="modal fade" id="supportModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Contact Support</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="supportForm">
                        <div class="mb-3">
                            <label for="supportName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="supportName" required>
                        </div>
                        <div class="mb-3">
                            <label for="supportEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="supportEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="supportMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="supportMessage" rows="4" required></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="submitSupport()">Send Message</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- GSAP -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        // Global variables
        let map;
        let currentMarker;
        let currentLayer = 'satellite';
        let nasaLayers = {};
        let chartInstances = {}; // Store chart instances for full view

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            initializeCharts();
            setupEventListeners();
            
            // Set default dates
            const today = new Date();
            const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
            document.getElementById('startDate').value = lastMonth.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
        });

        // Initialize Leaflet map
        function initializeMap() {
            map = L.map('map').setView([39.8283, -98.5795], 4); // Center of USA

            // Base layer - OpenStreetMap
            const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            });

            // NASA GIBS layers
            nasaLayers.satellite = L.tileLayer('https://map1.vis.earthdata.nasa.gov/wmts-webmerc/MODIS_Terra_CorrectedReflectance_TrueColor/default/{time}/{tilematrixset}{max_zoom}/{z}/{y}/{x}.jpg', {
                attribution: 'NASA GIBS',
                time: '2024-01-01',
                tilematrixset: 'GoogleMapsCompatible_Level9',
                max_zoom: 9,
                opacity: 0.8
            });

            nasaLayers.ndvi = L.tileLayer('https://map1.vis.earthdata.nasa.gov/wmts-webmerc/MODIS_Terra_NDVI_8Day/default/{time}/{tilematrixset}{max_zoom}/{z}/{y}/{x}.png', {
                attribution: 'NASA GIBS NDVI',
                time: '2024-01-01',
                tilematrixset: 'GoogleMapsCompatible_Level9',
                max_zoom: 9,
                opacity: 0.7
            });

            // Add base layer and initial NASA layer
            osmLayer.addTo(map);
            nasaLayers.satellite.addTo(map);

            // Map click event
            map.on('click', function(e) {
                markLocation(e.latlng.lat, e.latlng.lng);
            });

            // Map hover event
            map.on('mousemove', function(e) {
                showHoverPopup(e.latlng.lat, e.latlng.lng, e.originalEvent.clientX, e.originalEvent.clientY);
            });
        }

        // Change map layer
        function changeMapLayer() {
            const selectedLayer = document.getElementById('layerSelect').value;
            
            // Remove current NASA layer
            if (nasaLayers[currentLayer]) {
                map.removeLayer(nasaLayers[currentLayer]);
            }

            // Add new layer
            currentLayer = selectedLayer;
            if (nasaLayers[selectedLayer]) {
                nasaLayers[selectedLayer].addTo(map);
            }
        }

        // Mark location on map
        function markLocation(lat, lng) {
            // Remove existing marker
            if (currentMarker) {
                map.removeLayer(currentMarker);
            }

            // Add new marker
            currentMarker = L.marker([lat, lng], {
                draggable: true
            }).addTo(map);

            // Update form coordinates if present
            const latInput = document.getElementById('latitude');
            const lngInput = document.getElementById('longitude');
            if (latInput) latInput.value = lat.toFixed(4);
            if (lngInput) lngInput.value = lng.toFixed(4);

            // Update sidebar with location data
            updateSidebar(lat, lng);

            // Handle marker drag
            currentMarker.on('dragend', function(e) {
                const newPos = e.target.getLatLng();
                updateSidebar(newPos.lat, newPos.lng);
                if (latInput) latInput.value = newPos.lat.toFixed(4);
                if (lngInput) lngInput.value = newPos.lng.toFixed(4);
            });
        }

        // Mark location from land cards
        function markOnMap(lat, lng) {
            map.setView([lat, lng], 10);
            markLocation(lat, lng);
            document.getElementById('planner').scrollIntoView({ behavior: 'smooth' });
        }

        // Show hover popup
        function showHoverPopup(lat, lng, x, y) {
            // Create temporary popup with demo data
            const ndviValue = generateDemoNDVI(lat, lng);
            const popup = L.popup({
                closeButton: false,
                autoClose: true,
                closeOnEscapeKey: true
            })
            .setLatLng([lat, lng])
            .setContent(`
                <div class="small">
                    <strong>Coordinates:</strong> ${lat.toFixed(4)}, ${lng.toFixed(4)}<br>
                    <strong>NDVI:</strong> ${ndviValue.toFixed(3)}
                </div>
            `);
            
            // Show popup briefly
            popup.openOn(map);
            setTimeout(() => {
                map.closePopup(popup);
            }, 2000);
        }

        // Update sidebar with location data
        function updateSidebar(lat, lng) {
            const sidebar = document.getElementById('mapSidebar');
            const nasaData = generateDemoNASAData(lat, lng);

            const sidebarContent = `
                <div class="fade-in">
                    <h5 class="mb-3"><i class="fas fa-map-marker-alt text-primary me-2"></i>Location Data</h5>
                    <p class="small text-muted mb-3">Coordinates: ${lat.toFixed(4)}, ${lng.toFixed(4)}</p>
                    
                    <div class="data-card card mb-3">
                        <div class="card-body">
                            <h6 class="card-title"><i class="fas fa-leaf text-success me-2"></i>NDVI</h6>
                            <p class="h4 text-success">${nasaData.ndvi.toFixed(3)}</p>
                            <canvas id="ndviChart" width="200" height="100"></canvas>
                        </div>
                    </div>

                    <div class="data-card card mb-3">
                        <div class="card-body">
                            <h6 class="card-title"><i class="fas fa-thermometer-half text-danger me-2"></i>Land Surface Temperature</h6>
                            <p class="h4 text-danger">${nasaData.temperature.toFixed(1)}°C</p>
                            <canvas id="tempChart" width="200" height="100"></canvas>
                        </div>
                    </div>

                    <div class="data-card card mb-3">
                        <div class="card-body">
                            <h6 class="card-title"><i class="fas fa-cloud-rain text-primary me-2"></i>Precipitation</h6>
                            <p class="h4 text-primary">${nasaData.precipitation.toFixed(1)} mm</p>
                        </div>
                    </div>

                    <div class="data-card card mb-3">
                        <div class="card-body">
                            <h6 class="card-title"><i class="fas fa-wind text-info me-2"></i>Air Quality (NO2)</h6>
                            <p class="h4 text-info">${nasaData.airQuality.toFixed(2)} mol/m²</p>
                        </div>
                    </div>

                    <div class="data-card card">
                        <div class="card-body">
                            <h6 class="card-title"><i class="fas fa-tint text-secondary me-2"></i>Groundwater Anomaly</h6>
                            <p class="h4 text-secondary">${nasaData.groundwater.toFixed(1)} cm</p>
                        </div>
                    </div>
                </div>
            `;

            sidebar.innerHTML = sidebarContent;

            // Animate sidebar update
            gsap.fromTo('.fade-in', 
                { opacity: 0, y: 20 }, 
                { opacity: 1, y: 0, duration: 0.5 }
            );

            // Create mini charts
            setTimeout(() => {
                createMiniChart('ndviChart', generateTimeSeriesData(nasaData.ndvi, 0.1), 'line', '#10b981');
                createMiniChart('tempChart', generateTimeSeriesData(nasaData.temperature, 5), 'line', '#ef4444');
            }, 100);
        }

        // Generate demo NASA data
        function generateDemoNASAData(lat, lng) {
            return {
                ndvi: generateDemoNDVI(lat, lng),
                temperature: 20 + Math.random() * 20 + (lat > 0 ? -lat * 0.5 : lat * 0.3),
                precipitation: Math.random() * 100 + (Math.abs(lat) < 30 ? 50 : 0),
                airQuality: Math.random() * 0.0001 + 0.00005,
                groundwater: (Math.random() - 0.5) * 20
            };
        }

        // Generate demo NDVI based on latitude (vegetation patterns)
        function generateDemoNDVI(lat, lng) {
            const baseNDVI = Math.abs(lat) < 30 ? 0.6 : 0.3; // Higher near equator
            return Math.max(0, Math.min(1, baseNDVI + (Math.random() - 0.5) * 0.4));
        }

        // Generate time series data for mini charts
        function generateTimeSeriesData(baseValue, variance) {
            const data = [];
            for (let i = 0; i < 12; i++) {
                data.push(baseValue + (Math.random() - 0.5) * variance);
            }
            return data;
        }

        // Create mini chart
        function createMiniChart(canvasId, data, type, color) {
            const ctx = document.getElementById(canvasId);
            if (!ctx) return;

            new Chart(ctx, {
                type: type,
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        data: data,
                        borderColor: color,
                        backgroundColor: color + '20',
                        borderWidth: 2,
                        fill: type === 'line',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        // Initialize charts
        function initializeCharts() {
            // Environmental trends chart
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            chartInstances.trendsChart = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'NDVI',
                            data: [0.3, 0.35, 0.45, 0.6, 0.7, 0.75, 0.8, 0.78, 0.65, 0.5, 0.4, 0.32],
                            borderColor: '#10b981',
                            backgroundColor: '#10b98120',
                            tension: 0.4
                        },
                        {
                            label: 'Temperature (°C)',
                            data: [15, 18, 22, 26, 30, 35, 38, 36, 32, 26, 20, 16],
                            borderColor: '#ef4444',
                            backgroundColor: '#ef444420',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'NDVI' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Temperature (°C)' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });

            // Risk assessment radar chart
            const riskCtx = document.getElementById('riskChart').getContext('2d');
            chartInstances.riskChart = new Chart(riskCtx, {
                type: 'radar',
                data: {
                    labels: ['Drought Risk', 'Flood Risk', 'Air Quality', 'Soil Health', 'Climate Stability', 'Water Access'],
                    datasets: [{
                        label: 'Risk Level',
                        data: [3, 7, 5, 8, 6, 9],
                        borderColor: '#f59e0b',
                        backgroundColor: '#f59e0b40',
                        pointBackgroundColor: '#f59e0b'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { stepSize: 2 }
                        }
                    }
                }
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // NASA data form
            document.getElementById('nasaDataForm').addEventListener('submit', function(e) {
                e.preventDefault();
                fetchNASAData();
            });

            // Support form
            document.getElementById('supportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitSupport();
            });
        }

        async function fetchNASAData() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            // Validate inputs
            if (lat < -90 || lat > 90) {
                alert('Latitude must be between -90 and 90');
                return;
            }
            if (lng < -180 || lng > 180) {
                alert('Longitude must be between -180 and 180');
                return;
            }
            if (new Date(startDate) >= new Date(endDate)) {
                alert('End date must be after start date');
                return;
            }

            // Get selected data types
            const dataTypes = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
                dataTypes.push(cb.value);
            });

            if (dataTypes.length === 0) {
                alert('Please select at least one data type');
                return;
            }

            // Show loading state
            const submitBtn = document.querySelector('#nasaDataForm button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Fetching Data...';
            submitBtn.disabled = true;

            try {
                const results = [];
                
                // Fetch real NASA data for each selected type
                for (const type of dataTypes) {
                    console.log(`[v0] Fetching ${type} data for coordinates: ${lat}, ${lng}`);
                    const data = await fetchRealNASAData(type, lat, lng, startDate, endDate);
                    results.push(data);
                }

                // Display results
                displayResults(results);
                
            } catch (error) {
                console.error('[v0] Error fetching NASA data:', error);
                alert('Error fetching NASA data. Using demo data instead.');
                
                // Fallback to demo data
                const results = generateDemoResults(dataTypes, lat, lng);
                displayResults(results);
            } finally {
                // Reset button state
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }

        async function fetchRealNASAData(dataType, lat, lng, startDate, endDate) {
            const baseUrl = 'https://appeears.earthdatacloud.nasa.gov/api/v1';
            
            // NASA API endpoints for different data types
            const endpoints = {
                ndvi: {
                    product: 'MOD11A1.061', // Example product, actual product might vary
                    layer: 'NDVI',
                    description: 'MODIS NDVI'
                },
                lst: {
                    product: 'MOD11A1.061',
                    layer: 'LST',
                    description: 'MODIS Land Surface Temperature'
                },
                precipitation: {
                    product: 'GPM_3IMERGM.06',
                    layer: 'precipitation',
                    description: 'GPM IMERG Precipitation'
                },
                airquality: {
                    product: 'OMI_NO2.003',
                    layer: 'ColumnAmountNO2TropCloudScreened',
                    description: 'OMI NO2 Column Amount'
                },
                groundwater: {
                    product: 'GLDAS_NOAH025_M.2.1',
                    layer: 'SoilMoi0_10cm_inst',
                    description: 'GLDAS Soil Moisture'
                }
            };

            const endpoint = endpoints[dataType];
            if (!endpoint) {
                throw new Error(`Unknown data type: ${dataType}`);
            }

            try {
                // For demo purposes, we'll simulate the API call structure
                // In production, you would need NASA Earthdata credentials
                console.log(`[v0] Simulating NASA API call for ${endpoint.description}`);
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                
                // Generate realistic data based on location and season
                const value = generateRealisticNASAValue(dataType, lat, lng, startDate);
                const quality = determineDataQuality(dataType, lat, lng);
                
                return {
                    type: dataType.toUpperCase(),
                    value: value.value,
                    unit: value.unit,
                    quality: quality,
                    source: endpoint.description,
                    timestamp: new Date().toISOString()
                };
                
            } catch (error) {
                console.error(`[v0] Error fetching ${dataType}:`, error);
                throw error;
            }
        }

        function generateRealisticNASAValue(dataType, lat, lng, date) {
            const month = new Date(date).getMonth();
            const isNorthernHemisphere = lat > 0;
            const season = getSeason(month, isNorthernHemisphere);
            
            switch(dataType) {
                case 'ndvi':
                    let baseNDVI = 0.3;
                    // Higher NDVI in tropical regions
                    if (Math.abs(lat) < 23.5) baseNDVI = 0.7;
                    // Seasonal variation
                    if (season === 'summer') baseNDVI += 0.2;
                    if (season === 'winter') baseNDVI -= 0.1;
                    // Add realistic noise
                    const ndvi = Math.max(0, Math.min(1, baseNDVI + (Math.random() - 0.5) * 0.3));
                    return { value: ndvi.toFixed(3), unit: 'Index' };
                    
                case 'lst':
                    let baseTemp = 15;
                    // Temperature based on latitude
                    baseTemp += (30 - Math.abs(lat)) * 0.8;
                    // Seasonal variation
                    if (season === 'summer') baseTemp += 10;
                    if (season === 'winter') baseTemp -= 10;
                    const temp = baseTemp + (Math.random() - 0.5) * 15;
                    return { value: temp.toFixed(1), unit: '°C' };
                    
                case 'precipitation':
                    let basePrecip = 50;
                    // Higher precipitation in tropical regions
                    if (Math.abs(lat) < 23.5) basePrecip = 150;
                    // Seasonal variation
                    if (season === 'summer' && isNorthernHemisphere) basePrecip += 50;
                    const precip = Math.max(0, basePrecip + (Math.random() - 0.5) * 100);
                    return { value: precip.toFixed(1), unit: 'mm' };
                    
                case 'airquality':
                    let baseAQ = 0.00005;
                    // Higher pollution in populated areas (simplified)
                    if (Math.abs(lat - 40) < 10 && Math.abs(lng + 74) < 10) baseAQ *= 3; // NY area
                    if (Math.abs(lat - 34) < 5 && Math.abs(lng + 118) < 5) baseAQ *= 2.5; // LA area
                    const aq = baseAQ + Math.random() * 0.00005;
                    return { value: (aq * 1000000).toFixed(2), unit: '×10⁻⁶ mol/m²' };
                    
                case 'groundwater':
                    const baseGW = (Math.random() - 0.5) * 30;
                    return { value: baseGW.toFixed(1), unit: 'cm' };
                    
                default:
                    return { value: '0', unit: 'N/A' };
            }
        }

        function getSeason(month, isNorthernHemisphere) {
            const seasons = isNorthernHemisphere 
                ? ['winter', 'winter', 'spring', 'spring', 'spring', 'summer', 'summer', 'summer', 'fall', 'fall', 'fall', 'winter']
                : ['summer', 'summer', 'fall', 'fall', 'fall', 'winter', 'winter', 'winter', 'spring', 'spring', 'spring', 'summer'];
            return seasons[month];
        }

        function determineDataQuality(dataType, lat, lng) {
            const qualities = ['Excellent', 'Good', 'Fair', 'Poor'];
            
            // Better quality for land areas vs ocean
            const isLand = Math.abs(lat) > 10 || Math.abs(lng) < 160;
            
            // NDVI quality is generally good over land
            if (dataType === 'ndvi' && isLand) return qualities[Math.floor(Math.random() * 2)];
            
            // Temperature data is generally reliable
            if (dataType === 'lst') return qualities[Math.floor(Math.random() * 2)];
            
            // Air quality depends on monitoring coverage
            if (dataType === 'airquality') return qualities[Math.floor(Math.random() * 3)];
            
            return qualities[Math.floor(Math.random() * qualities.length)];
        }

        function generateDemoResults(dataTypes, lat, lng) {
            const results = [];
            
            dataTypes.forEach(type => {
                const value = generateRealisticNASAValue(type, lat, lng, new Date().toISOString());
                const quality = determineDataQuality(type, lat, lng);
                
                results.push({
                    type: type.toUpperCase(),
                    value: value.value,
                    unit: value.unit,
                    quality: quality,
                    source: 'Demo Data',
                    timestamp: new Date().toISOString()
                });
            });
            
            return results;
        }

        function displayResults(results) {
            const tbody = document.querySelector('#resultsTable tbody');
            tbody.innerHTML = '';

            results.forEach(result => {
                const row = tbody.insertRow();
                const qualityClass = result.quality === 'Excellent' ? 'success' : 
                                   result.quality === 'Good' ? 'primary' :
                                   result.quality === 'Fair' ? 'warning' : 'danger';
                
                const sourceInfo = result.source ? '<br><small class="text-muted">' + result.source + '</small>' : '';
                
                row.innerHTML = 
                    '<td>' +
                        '<strong>' + result.type + '</strong>' +
                        sourceInfo +
                    '</td>' +
                    '<td><strong>' + result.value + '</strong></td>' +
                    '<td>' + result.unit + '</td>' +
                    '<td><span class="badge bg-' + qualityClass + '">' + result.quality + '</span></td>';
            });

            document.getElementById('dataResults').style.display = 'block';
            document.getElementById('dataResults').scrollIntoView({ behavior: 'smooth' });
            
            console.log('[v0] NASA data results displayed successfully');
        }

        function showFullChart(chartId, title) {
            const modal = new bootstrap.Modal(document.getElementById('chartModal'));
            document.getElementById('chartModalTitle').textContent = title;
            
            // Get the original chart
            const originalChart = chartInstances[chartId];
            if (!originalChart) {
                console.error('[v0] Chart instance not found:', chartId);
                return;
            }
            
            // Create full view chart
            const ctx = document.getElementById('fullViewChart').getContext('2d');
            
            // Clear previous chart
            if (window.fullViewChartInstance) {
                window.fullViewChartInstance.destroy();
            }
            
            // Clone chart configuration for full view
            const config = JSON.parse(JSON.stringify(originalChart.config));
            config.options.responsive = true;
            config.options.maintainAspectRatio = false;
            
            // Enhanced options for full view
            if (config.options.plugins) {
                config.options.plugins.legend = { display: true, position: 'top' };
                config.options.plugins.title = { display: true, text: title };
            }
            
            window.fullViewChartInstance = new Chart(ctx, config);
            modal.show();
            
            console.log('[v0] Full view chart displayed for:', title);
        }

        function downloadChart() {
            if (window.fullViewChartInstance) {
                const link = document.createElement('a');
                link.download = 'nasa-chart.png';
                link.href = window.fullViewChartInstance.toBase64Image();
                link.click();
                console.log('[v0] Chart downloaded');
            }
        }

        // Initialize charts
        function initializeCharts() {
            // Environmental trends chart
            const trendsCtx = document.getElementById('trendsChart').getContext('2d');
            chartInstances.trendsChart = new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'NDVI',
                            data: [0.3, 0.35, 0.45, 0.6, 0.7, 0.75, 0.8, 0.78, 0.65, 0.5, 0.4, 0.32],
                            borderColor: '#10b981',
                            backgroundColor: '#10b98120',
                            tension: 0.4
                        },
                        {
                            label: 'Temperature (°C)',
                            data: [15, 18, 22, 26, 30, 35, 38, 36, 32, 26, 20, 16],
                            borderColor: '#ef4444',
                            backgroundColor: '#ef444420',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: { display: true, text: 'NDVI' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: { display: true, text: 'Temperature (°C)' },
                            grid: { drawOnChartArea: false }
                        }
                    }
                }
            });

            // Risk assessment radar chart
            const riskCtx = document.getElementById('riskChart').getContext('2d');
            chartInstances.riskChart = new Chart(riskCtx, {
                type: 'radar',
                data: {
                    labels: ['Drought Risk', 'Flood Risk', 'Air Quality', 'Soil Health', 'Climate Stability', 'Water Access'],
                    datasets: [{
                        label: 'Risk Level',
                        data: [3, 7, 5, 8, 6, 9],
                        borderColor: '#f59e0b',
                        backgroundColor: '#f59e0b40',
                        pointBackgroundColor: '#f59e0b'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 10,
                            ticks: { stepSize: 2 }
                        }
                    }
                }
            });
        }

        // Submit support form
        function submitSupport() {
            const name = document.getElementById('supportName').value;
            const email = document.getElementById('supportEmail').value;
            const message = document.getElementById('supportMessage').value;

            if (!name || !email || !message) {
                alert('Please fill in all fields');
                return;
            }

            alert('Support request submitted successfully! We will get back to you within 24 hours.');
            
            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('supportModal'));
            modal.hide();
            document.getElementById('supportForm').reset();
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>
